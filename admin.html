<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت سافت شیراز</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet">
    <style>
        :root { --bg: #0e0e0f; --card: #1c1c1e; --gold: #ffd700; --text: #fff; --blue: #0037ff; --black: #000000; }
        body { font-family: "Vazirmatn", sans-serif; background: var(--bg); color: var(--text); padding: 15px; direction: rtl; }
        .container { max-width: 600px; margin: auto; background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #333; }
        h2 { color: var(--gold); text-align: center; font-size: 20px; }
        .field { margin-bottom: 12px; }
        label { display: block; font-size: 12px; color: #888; margin-bottom: 4px; }
        input, textarea, select { width: 100%; padding: 10px; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; box-sizing: border-box; font-family: inherit; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-box { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .save { background: var(--gold); color: #000; }
        .del { background: #ff4444; color: #fff; }
        #msg { margin-top: 15px; text-align: center; font-size: 14px; padding: 10px; border-radius: 8px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>مدیریت اکران‌ها</h2>
    
    <div class="grid">
        <div class="field"><label>رمز پنل (3339)</label><input type="password" id="pass"></div>
        <div class="field"><label>شماره کارت (1 تا 50)</label><input type="number" id="num"></div>
    </div>

    <div class="grid">
        <div class="field"><label>نام فیلم</label><input type="text" id="title" placeholder="بچه‌های بد"></div>
        <div class="field"><label>زمان (روز - ساعت)</label><input type="text" id="time" placeholder="چهارشنبه 10 دی - 16:00"></div>
    </div>

    <div class="field"><label>لینک عکس پوستر</label><input type="text" id="img" placeholder="../web/png/17.png"></div>

    <div class="grid">
        <div class="field"><label>ژانر</label><input type="text" id="genre"></div>
        <div class="field"><label>امتیاز</label><input type="text" id="rate"></div>
    </div>

    <div class="grid">
        <div class="field"><label>رده سنی</label><input type="text" id="age"></div>
        <div class="field"><label>مدت زمان</label><input type="text" id="duration"></div>
    </div>

    <div class="field"><label>خلاصه داستان</label><textarea id="summary" rows="3"></textarea></div>

    <div class="field">
        <label>وضعیت دکمه</label>
        <select id="t_status">
            <option value="blue">فعال (تهیه بلیط - آبی)</option>
            <option value="black">تکمیل (ظرفیت تکمیل - مشکی)</option>
        </select>
    </div>

    <div class="btn-box">
        <button class="save" onclick="handleAction('save')">ذخیره کارت</button>
        <button class="del" onclick="handleAction('delete')">حذف کارت</button>
    </div>

    <div id="msg"></div>
</div>

<script>
    const WORKER_URL = "https://admin.softshiraz.workers.dev/";

    async function handleAction(action) {
        const msg = document.getElementById('msg');
        const pass = document.getElementById('pass').value;
        const num = document.getElementById('num').value;

        if(!pass || !num) { alert("رمز و شماره کارت الزامی است"); return; }

        msg.style.display = "block";
        msg.style.background = "#444";
        msg.style.color = "#fff";
        msg.innerText = "در حال برقراری ارتباط با ورکر...";

        let finalContent = "";
        
        if(action === 'save') {
            const t_mode = document.getElementById('t_status').value;
            const t_color = t_mode === 'blue' ? '#0037ff' : '#000000';
            const t_text = t_mode === 'blue' ? 'تهیه بلیط' : 'ظرفیت تکمیل شده';
            const t_class = t_mode === 'blue' ? '' : 'disabled';

            finalContent = `
<div class="card-inner">
    <div class="card-front" data-admin-id="softshirazadmin2">
        <div class="date-bar" style="border-top-width: 0px;">${document.getElementById('title').value}</div>
        <div class="img-bar"><img src="${document.getElementById('img').value}" alt="poster"></div> 
        <div class="title-bar" style="border-top-width: 0px;">${document.getElementById('time').value}</div>
        <div class="reserve-bar" style="border-top-width: 0px;">
            <a class="reserve-btn ${t_class}" style="color: ${t_color} !important;">${t_text}</a>
        </div>
    </div>
    <div class="card-back">
        <p><strong>انیمیشن : </strong>${document.getElementById('title').value}</p>
        <p><strong>ژانر : </strong>${document.getElementById('genre').value}</p>
        <p><strong>امتیاز : </strong>${document.getElementById('rate').value}</p>
        <p><strong>رده سنی : </strong>${document.getElementById('age').value}</p>
        <p><strong>مدت زمان : </strong>${document.getElementById('duration').value}</p>
        <p><strong>خلاصه : </strong>${document.getElementById('summary').value}</p>
    </div>
</div>`.trim();
        }

        try {
            const response = await fetch(WORKER_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    password: pass,
                    path: `cards/${num}.html`,
                    content: btoa(unescape(encodeURIComponent(finalContent))),
                    action: action
                })
            });

            const result = await response.json();

            if (response.ok) {
                msg.style.background = "#1b5e20";
                msg.innerText = action === 'delete' ? "✅ حذف شد!" : "✅ ذخیره شد!";
            } else {
                msg.style.background = "#b71c1c";
                msg.innerText = "❌ خطا: " + (result.error || "خطای سرور");
            }
        } catch (e) {
            msg.style.background = "#b71c1c";
            msg.innerText = "❌ ارتباط با ورکر برقرار نشد. آدرس ورکر را چک کنید.";
        }
    }
</script>
</body>
</html>
