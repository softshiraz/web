<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§ÙØª Ø´ÛŒØ±Ø§Ø²</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet">
    <style>
        :root { --bg: #0e0e0f; --card: #1c1c1e; --gold: #ffd700; --text: #fff; }
        body {
            font-family: "Vazirmatn", sans-serif;
            background: var(--bg); color: var(--text);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 20px;
        }
        .admin-box {
            background: var(--card); border: 1px solid #333;
            padding: 30px; border-radius: 20px; width: 100%; max-width: 500px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        h2 { color: var(--gold); text-align: center; margin-bottom: 25px; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-size: 14px; color: #ccc; }
        input, select {
            width: 100%; padding: 12px; background: #000; border: 1px solid #444;
            color: #fff; border-radius: 10px; font-family: inherit; outline: none;
            transition: 0.3s;
        }
        input:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .checkbox-wrapper input { width: auto; }
        
        button {
            width: 100%; padding: 14px; background: var(--gold); color: #000;
            border: none; border-radius: 12px; font-weight: 900; font-size: 16px;
            cursor: pointer; margin-top: 20px; transition: 0.3s;
        }
        button:hover { background: #ffea00; transform: scale(1.02); }
        button:disabled { background: #555; cursor: not-allowed; }
        
        #status { margin-top: 15px; text-align: center; font-size: 14px; min-height: 20px; }
        .preview-link { text-align: center; margin-top: 15px; display: block; color: var(--gold); text-decoration: none; font-size: 13px; }
    </style>
</head>
<body>

<div class="admin-box">
    <h2>ğŸ¬ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ú©Ø±Ø§Ù†</h2>
    
    <div class="form-group">
        <label>Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª (Ù…Ø«Ù„Ø§Ù‹ 1)</label>
        <input type="number" id="cardNumber" placeholder="Ø´Ù…Ø§Ø±Ù‡ ÙØ§ÛŒÙ„ (1 ØªØ§ 50)">
    </div>

    <div class="form-group">
        <label>Ù†Ø§Ù… ÙÛŒÙ„Ù…</label>
        <input type="text" id="movieTitle" placeholder="Ù…Ø«Ù„Ø§Ù‹: Your Name">
    </div>

    <div class="form-group">
        <label>Ø²Ù…Ø§Ù† Ø§Ú©Ø±Ø§Ù†</label>
        <input type="text" id="dateTime" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¬Ù…Ø¹Ù‡ Û²Ûµ Ø¢Ø¨Ø§Ù† Ø³Ø§Ø¹Øª Û±Û¶:Û°Û°">
    </div>

    <div class="form-group">
        <label>Ù„ÛŒÙ†Ú© Ù¾ÙˆØ³ØªØ± (Ø¹Ú©Ø³)</label>
        <input type="text" id="imageLink" placeholder="https://...">
    </div>

    <div class="form-group">
        <label>Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù¾Ø§Ø³Ø®Ú¯Ùˆ (Ø¨Ø¯ÙˆÙ† @)</label>
        <input type="text" id="adminId" value="softshirazadmin" placeholder="softshirazadmin">
    </div>

    <div class="form-group checkbox-wrapper">
        <input type="checkbox" id="hasDiscount">
        <label for="hasDiscount" style="margin:0; cursor:pointer;">Ø§ÛŒÙ† Ø§Ú©Ø±Ø§Ù† ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡ Ø¯Ø§Ø±Ø¯ØŸ</label>
    </div>

    <button onclick="publishCard()" id="submitBtn">Ø§Ù†ØªØ´Ø§Ø± Ú©Ø§Ø±Øª</button>
    <div id="status"></div>
    <a href="./index.html" class="preview-link">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø³Ø§ÛŒØª</a>
</div>

<script>
    // Ø¢Ø¯Ø±Ø³ ÙˆØ±Ú©Ø±ÛŒ Ú©Ù‡ Ø³Ø§Ø®ØªÛŒ
    const WORKER_URL = "https://admin.softshiraz.workers.dev/";

    async function publishCard() {
        const btn = document.getElementById('submitBtn');
        const status = document.getElementById('status');
        
        // Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø§Ø¯ÛŒØ±
        const num = document.getElementById('cardNumber').value;
        const title = document.getElementById('movieTitle').value;
        const time = document.getElementById('dateTime').value;
        const img = document.getElementById('imageLink').value;
        const admin = document.getElementById('adminId').value;
        const discount = document.getElementById('hasDiscount').checked;

        if (!num || !title || !time || !img) {
            status.style.color = "#ff4444";
            status.innerText = "Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.";
            return;
        }

        btn.disabled = true;
        btn.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...";
        status.innerText = "";

        // Ø³Ø§Ø®Øª Ú©Ø¯ HTML Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ù†Ø·Ø¨Ù‚ Ø¨Ø± Ù‚Ø§Ù„Ø¨ Ø³Ø§ÛŒØª Ø´Ù…Ø§
        const htmlContent = `
<div class="card-inner">
    <div class="card-front" data-admin-id="${admin}">
        <div class="discount-label ${discount ? '' : 'hidden'}">ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡</div>
        <div class="img-bar">
            <img src="${img}" alt="${title}" loading="lazy">
        </div>
        <div class="date-bar"><strong>${title}</strong></div>
        <div class="title-bar">${time}</div>
        <div class="reserve-bar"><a style="text-decoration:none; color:inherit;">ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·</a></div>
    </div>
    <div class="card-back">
        <h3>ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ú©Ø±Ø§Ù†</h3>
        <p><strong>ÙÛŒÙ„Ù…:</strong> ${title}</p>
        <p><strong>Ø²Ù…Ø§Ù†:</strong> ${time}</p>
        <p>Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ· Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</p>
    </div>
</div>`.trim();

        // ØªØ¨Ø¯ÛŒÙ„ Ù…Ø­ØªÙˆØ§ Ø¨Ù‡ ÙØ±Ù…Øª Base64 Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ (Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§Ø±Ø³ÛŒ)
        const base64Content = btoa(unescape(encodeURIComponent(htmlContent)));

        try {
            const response = await fetch(WORKER_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    path: `cards/${num}.html`,
                    content: base64Content,
                    message: `Update card ${num} via Admin Panel`
                })
            });

            if (response.ok) {
                status.style.color = "#00ff00";
                status.innerHTML = `âœ… Ú©Ø§Ø±Øª Ø´Ù…Ø§Ø±Ù‡ ${num} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯!<br>ØªØºÛŒÛŒØ±Ø§Øª ØªØ§ Û± Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`;
            } else {
                const errData = await response.json();
                status.style.color = "#ff4444";
                status.innerText = "âŒ Ø®Ø·Ø§: " + (errData.message || "Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯");
                console.error(errData);
            }
        } catch (error) {
            status.style.color = "#ff4444";
            status.innerText = "âŒ Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±";
            console.error(error);
        }

        btn.disabled = false;
        btn.innerText = "Ø§Ù†ØªØ´Ø§Ø± Ú©Ø§Ø±Øª";
    }
</script>

</body>
</html>
