<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ ÙÙˆÙ‚ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø³Ø§ÙØª Ø´ÛŒØ±Ø§Ø²</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet">
    <style>
        :root { --bg: #0e0e0f; --card: #1c1c1e; --gold: #ffd700; --text: #fff; --green: #2e7d32; --red: #ff4444; --blue: #0037ff; }
        body { font-family: "Vazirmatn", sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; direction: rtl; min-height: 100vh; }
       
        /* Login Page */
        #login-page { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; box-sizing: border-box; }
        .login-box { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #333; width: 100%; max-width: 350px; text-align: center; }

        /* Admin Panel Layout */
        #admin-panel { display: none; padding: 15px; max-width: 1600px; margin: auto; }

        /* Grid Layout Ø¨Ø§ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ú©Ø§Ù…Ù„ */
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .admin-grid {
                grid-template-columns: 300px 1fr;
            }
            .preview-sidebar { grid-column: 1 / -1; }
        }

        @media (min-width: 1024px) {
            .admin-grid {
                grid-template-columns: 320px 1fr 350px;
            }
            .preview-sidebar { grid-column: unset; }
        }

        @media (min-width: 1400px) {
            .admin-grid { gap: 25px; }
        }

        /* Shared Styles */
        .box { background: var(--card); border: 1px solid #333; border-radius: 15px; padding: 20px; height: fit-content; }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            background: #000;
            border: 1px solid #444;
            color: #fff;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: inherit;
            margin-top: 6px;
            font-size: 15px;
        }
        label { font-size: 13px; color: #aaa; display: block; margin-bottom: 4px; }
        button {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            font-family: inherit;
            font-size: 15px;
        }

        /* Sidebar */
        .file-list {
            background: #000;
            border-radius: 10px;
            height: 450px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #222;
        }
        .file-item {
            padding: 12px;
            border-bottom: 1px solid #111;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        .file-item:hover { background: #1a1a1a; color: var(--gold); }
        .search-box { margin-bottom: 12px; }

        /* ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .cards-count { margin: 10px 0; font-size: 14px; color: var(--gold); text-align: center; }

        /* Form Grid Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        @media (min-width: 768px) {
            .form-grid { grid-template-columns: 1fr 1fr; }
        }

        /* Preview Sidebar */
        .preview-container { position: relative; top: unset; text-align: center; margin-top: 10px; }
        .card-preview-box {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #444;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .p-img { width: 100%; height: 380px; object-fit: cover; }
        .p-title { padding: 12px; background: #111; font-weight: bold; color: var(--gold); border-top: 1px solid #333; font-size: 16px; }
        .p-date { padding: 10px; font-size: 13px; background: #000; color: #ccc; }
        .p-btn { padding: 14px; background: #111; border-top: 1px solid #333; font-weight: bold; font-size: 16px; }

        /* Buttons */
        .save-btn { background: var(--gold); color: #000; width: 100%; margin-top: 15px; }
        .del-btn { background: var(--red); color: #fff; width: 100%; margin-top: 8px; }
        .add-btn { background: var(--green); color: #fff; width: 100%; margin-bottom: 12px; }

        /* Status & Info */
        #status { margin-top: 15px; text-align: center; font-size: 15px; min-height: 24px; }

        /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ù†Ø±Ù… Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="login-page">
        <div class="login-box">
            <h2 style="color:var(--gold); margin-top:0;">ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</h2>
            <input type="password" id="admin-pass" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
            <button class="save-btn" onclick="login()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„</button>
        </div>
    </div>

    <div id="admin-panel">
        <div class="admin-grid">
            <!-- Sidebar -->
            <div class="sidebar box">
                <h3 style="margin-top:0">ğŸ“‚ Ù„ÛŒØ³Øª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</h3>
                <div class="cards-count" id="cards-count">ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§: Û°</div>
                <input type="text" id="search" class="search-box" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ù†Ø§Ù… ÙÛŒÙ„Ù… ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡..." oninput="filterFiles()">
                <button class="add-btn" onclick="clearForm()">â• Ø³Ø§Ø®Øª Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯</button>
                <div class="file-list" id="file-list">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
            </div>

            <!-- Main Form -->
            <div class="main-form box">
                <h3 style="margin-top:0; color:var(--gold)">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h3>
                <div class="form-grid">
                    <div><label>Ø´Ù…Ø§Ø±Ù‡ ÙØ§ÛŒÙ„</label><input type="number" id="num" oninput="updatePreview()"></div>
                    <div><label>Ù†Ø§Ù… Ø§Ù†ÛŒÙ…ÛŒØ´Ù†</label><input type="text" id="title" oninput="updatePreview()"></div>
                    <div><label>ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù†</label><input type="text" id="time" oninput="updatePreview()" placeholder="Ù…Ø«Ù„Ø§: Û±Û° Ø¯ÛŒ - Û±Û¶:Û°Û°"></div>
                    <div><label>Ù„ÛŒÙ†Ú© Ù¾ÙˆØ³ØªØ±</label><input type="text" id="img" oninput="updatePreview()"></div>
                    <div><label>Ú˜Ø§Ù†Ø±</label><input type="text" id="genre" oninput="updatePreview()"></div>
                    <div><label>Ø§Ù…ØªÛŒØ§Ø²</label><input type="text" id="rate" oninput="updatePreview()"></div>
                    <div><label>Ø±Ø¯Ù‡ Ø³Ù†ÛŒ</label><input type="text" id="age" oninput="updatePreview()"></div>
                    <div><label>Ù…Ø¯Øª Ø²Ù…Ø§Ù†</label><input type="text" id="duration" oninput="updatePreview()"></div>
                </div>
                <label>Ø®Ù„Ø§ØµÙ‡ Ø¯Ø§Ø³ØªØ§Ù†</label>
                <textarea id="summary" rows="5" oninput="updatePreview()"></textarea>
                
                <label>ÙˆØ¶Ø¹ÛŒØª Ø§Ú©Ø±Ø§Ù†</label>
                <select id="t_status" onchange="updatePreview()">
                    <option value="blue">ÙØ¹Ø§Ù„ (Ø¢Ø¨ÛŒ)</option>
                    <option value="black">Ø¸Ø±ÙÛŒØª ØªÚ©Ù…ÛŒÙ„ (Ù…Ø´Ú©ÛŒ)</option>
                </select>

                <button class="save-btn" onclick="submit('save')">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø§Ù†ØªØ´Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ</button>
                <button class="del-btn" onclick="submit('delete')">ğŸ—‘ï¸ Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Øª</button>
                <div id="status"></div>
                <div style="text-align:center; margin-top:15px; font-size:13px; color:#888;">ğŸ“ˆ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒÚ©â€ŒÙ‡Ø§ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´...</div>
            </div>

            <!-- Preview -->
            <div class="preview-sidebar preview-container box">
                <h3 style="margin-top:0">ğŸ‘€ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</h3>
                <div class="card-preview-box">
                    <div id="pre-img-div"><img src="" id="p-img" class="p-img" alt="Ù¾ÙˆØ³ØªØ±"></div>
                    <div id="p-title" class="p-title">Ù†Ø§Ù… Ø§Ù†ÛŒÙ…ÛŒØ´Ù†</div>
                    <div id="p-date" class="p-date">ØªØ§Ø±ÛŒØ® Ø§Ú©Ø±Ø§Ù†</div>
                    <div id="p-btn" class="p-btn" style="color:var(--blue)">ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·</div>
                </div>
                <p style="font-size:12px; color:#666; margin-top:20px;">Ø§ÛŒÙ† Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø´Ø§Ø¨Ù‡ Ø¸Ø§Ù‡Ø± Ø³Ø§ÛŒØª Ø´Ù…Ø§Ø³Øª.</p>
            </div>
        </div>
    </div>

    <script>
        const WORKER_URL = "https://admin.softshiraz.workers.dev/";
        let globalPass = "";
        let allFiles = []; // [{name, path, title}]

        function login() {
            if(document.getElementById('admin-pass').value === "3339") {
                globalPass = "3339";
                document.getElementById('login-page').style.display = "none";
                document.getElementById('admin-panel').style.display = "block";
                loadList();
            } else alert("Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡");
        }

        async function loadList() {
            const res = await fetch(`${WORKER_URL}?pass=${globalPass}`);
            const files = await res.json();
            allFiles = files
                .filter(f => f.name.endsWith('.html'))
                .map(f => ({
                    name: f.name,
                    path: f.path,
                    title: "" // Ø¨Ø¹Ø¯Ø§Ù‹ Ù¾Ø± Ù…ÛŒâ€ŒØ´Ù‡
                }))
                .sort((a,b) => (parseInt(a.name)||0) - (parseInt(b.name)||0));

            // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¹Ù†ÙˆØ§Ù†â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ù‡ØªØ±
            for(let file of allFiles) {
                try {
                    const res = await fetch(`${WORKER_URL}?pass=${globalPass}&path=${file.path}`);
                    const data = await res.json();
                    const html = decodeURIComponent(escape(atob(data.content)));
                    const doc = new DOMParser().parseFromString(html, 'text/html');
                    file.title = doc.querySelector('.date-bar')?.innerText.trim() || "";
                } catch(e) {
                    file.title = "";
                }
            }

            renderList(allFiles);
            updateCardsCount();
        }

        function updateCardsCount() {
            document.getElementById('cards-count').innerText = `ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§: ${allFiles.length}`;
        }

        function renderList(files) {
            const list = document.getElementById('file-list');
            list.innerHTML = "";
            files.forEach(f => {
                const d = document.createElement('div');
                d.className = 'file-item';
                d.innerHTML = `<span>Ú©Ø§Ø±Øª ${f.name.replace('.html','')} ${f.title ? 'â€“ ' + f.title : ''}</span> <span>âš™ï¸</span>`;
                d.onclick = () => loadFile(f.path);
                list.appendChild(d);
            });
        }

        function filterFiles() {
            const term = document.getElementById('search').value.toLowerCase().trim();
            if(!term) {
                renderList(allFiles);
                return;
            }
            const filtered = allFiles.filter(f => 
                f.name.toLowerCase().includes(term) ||
                (f.title && f.title.toLowerCase().includes(term))
            );
            renderList(filtered);
        }

        async function loadFile(path) {
            document.getElementById('status').innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù„ÙˆØ¯...";
            const res = await fetch(`${WORKER_URL}?pass=${globalPass}&path=${path}`);
            const data = await res.json();
            const html = decodeURIComponent(escape(atob(data.content)));
            const doc = new DOMParser().parseFromString(html, 'text/html');
           
            document.getElementById('num').value = path.replace('cards/','').replace('.html','');
            document.getElementById('title').value = doc.querySelector('.date-bar')?.innerText || "";
            document.getElementById('time').value = doc.querySelector('.title-bar')?.innerText || "";
            document.getElementById('img').value = doc.querySelector('img')?.src || "";
            const ps = doc.querySelectorAll('.card-back p');
            document.getElementById('genre').value = ps[1]?.innerText.split(': ')[1] || "";
            document.getElementById('rate').value = ps[2]?.innerText.split(': ')[1] || "";
            document.getElementById('age').value = ps[3]?.innerText.split(': ')[1] || "";
            document.getElementById('duration').value = ps[4]?.innerText.split(': ')[1] || "";
            document.getElementById('summary').value = ps[5]?.innerText.split(': ')[1] || "";
            document.getElementById('t_status').value = doc.querySelector('.reserve-btn')?.classList.contains('disabled') ? 'black' : 'blue';
            updatePreview();
            document.getElementById('status').innerText = "";
        }

        function updatePreview() {
            document.getElementById('p-title').innerText = document.getElementById('title').value || "Ù†Ø§Ù… Ø§Ù†ÛŒÙ…ÛŒØ´Ù†";
            document.getElementById('p-date').innerText = document.getElementById('time').value || "ØªØ§Ø±ÛŒØ® Ø§Ú©Ø±Ø§Ù†";
            document.getElementById('p-img').src = document.getElementById('img').value || "";
            const mode = document.getElementById('t_status').value;
            const btn = document.getElementById('p-btn');
            btn.innerText = mode === 'blue' ? 'ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·' : 'Ø¸Ø±ÙÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡';
            btn.style.color = mode === 'blue' ? 'var(--blue)' : '#555';
        }

        function clearForm() {
            ['num','title','time','img','genre','rate','age','duration','summary'].forEach(id => document.getElementById(id).value = "");
            document.getElementById('t_status').value = "blue";
            updatePreview();
        }

        async function submit(action) {
            if(action === 'delete') {
                if(!confirm("Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Øª Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ú©Ù†ÛŒØŸ")) return;
            }

            const num = document.getElementById('num').value.trim();
            if(action === 'save' && !num) { 
                alert("Ø´Ù…Ø§Ø±Ù‡ ÙØ§ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!"); 
                return; 
            }
            
            const status = document.getElementById('status');
            status.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...";

            let content = "";
            if(action === 'save') {
                const t_mode = document.getElementById('t_status').value;
                const t_color = t_mode === 'blue' ? '#0037ff' : '#000000';
                const html = `<div class="card-inner">
<div class="card-front" data-admin-id="softshirazadmin2">
<div class="date-bar" style="border-top-width: 0px;">${document.getElementById('title').value}</div>
<div class="img-bar"><img src="${document.getElementById('img').value}" alt="p"></div>
<div class="title-bar" style="border-top-width: 0px;">${document.getElementById('time').value}</div>
<div class="reserve-bar" style="border-top-width: 0px;"><a class="reserve-btn ${t_mode==='black'?'disabled':''}" style="color: ${t_color} !important;">${t_mode==='blue'?'ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·':'Ø¸Ø±ÙÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡'}</a></div>
</div>
<div class="card-back">
<p><strong>Ø§Ù†ÛŒÙ…ÛŒØ´Ù† : </strong>${document.getElementById('title').value}</p>
<p><strong>Ú˜Ø§Ù†Ø± : </strong>${document.getElementById('genre').value}</p>
<p><strong>Ø§Ù…ØªÛŒØ§Ø² : </strong>${document.getElementById('rate').value}</p>
<p><strong>Ø±Ø¯Ù‡ Ø³Ù†ÛŒ : </strong>${document.getElementById('age').value}</p>
<p><strong>Ù…Ø¯Øª Ø²Ù…Ø§Ù† : </strong>${document.getElementById('duration').value}</p>
<p><strong>Ø®Ù„Ø§ØµÙ‡ : </strong>${document.getElementById('summary').value}</p>
</div></div>`.trim();
                content = btoa(unescape(encodeURIComponent(html)));
            }

            const res = await fetch(WORKER_URL, {
                method: "POST",
                body: JSON.stringify({ password: globalPass, path: `cards/${num}.html`, content, action })
            });

            if(res.ok) {
                status.innerText = "âœ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯";
                loadList(); // Ù„ÛŒØ³Øª Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø±Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ù‡
                if(action === 'delete') clearForm();
            } else {
                status.innerText = "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±";
            }
        }
    </script>
</body>
</html>
