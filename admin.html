<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ø§ÙØª Ø´ÛŒØ±Ø§Ø²</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet">
    <style>
        :root { --gold: #ffd700; --bg: #0e0e0f; --card: #1c1c1e; }
        body { font-family: Vazirmatn; background: var(--bg); color: #fff; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        #login-page, #admin-page { background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .hidden { display: none; }
        input, textarea, select { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 10px; margin: 10px 0; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .gold-btn { background: var(--gold); color: #000; }
        .card-item { background: #2c2c2e; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #444; }
        .del-badge { background: #ff4444; color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer; }
        .refresh-btn { background: #444; color: #fff; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-page">
        <h2 style="text-align:center; color:var(--gold)">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
        <input type="password" id="admin-pass" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
        <button class="gold-btn" onclick="login()">ÙˆØ±ÙˆØ¯</button>
        <p id="login-err" style="color:red; text-align:center"></p>
    </div>

    <div id="admin-page" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <h2 style="color:var(--gold)">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</h2>
            <button onclick="logout()" style="width:auto; background:red; color:#fff">Ø®Ø±ÙˆØ¬</button>
        </div>

        <details style="background:#2c2c2e; padding:15px; border-radius:10px; margin-bottom:20px">
            <summary style="cursor:pointer; font-weight:bold">Ø§ÙØ²ÙˆØ¯Ù† / ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯ +</summary>
            <input type="number" id="num" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª (Ù…Ø«Ù„Ø§ 1)">
            <input type="text" id="title" placeholder="Ù†Ø§Ù… Ø§Ù†ÛŒÙ…ÛŒØ´Ù†">
            <input type="text" id="time" placeholder="Ø²Ù…Ø§Ù† Ø§Ú©Ø±Ø§Ù†">
            <input type="text" id="img" placeholder="Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ (../web/png/1.png)">
            <select id="t_status">
                <option value="blue">ÙØ¹Ø§Ù„ (Ø¢Ø¨ÛŒ)</option>
                <option value="black">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ (Ù…Ø´Ú©ÛŒ)</option>
            </select>
            <textarea id="summary" placeholder="Ø®Ù„Ø§ØµÙ‡ Ø¯Ø§Ø³ØªØ§Ù†" rows="3"></textarea>
            <button class="gold-btn" onclick="saveCard()">Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Øª</button>
        </details>

        <button class="refresh-btn" onclick="loadCardList()">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</button>
        <div id="card-list">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª...</div>
    </div>
</div>

<script>
    const WORKER_URL = "https://admin.softshiraz.workers.dev/";
    let currentPassword = "";

    function login() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === "3339") {
            currentPassword = pass;
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('admin-page').classList.remove('hidden');
            loadCardList();
        } else {
            document.getElementById('login-err').innerText = "Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!";
        }
    }

    function logout() { location.reload(); }

    async function loadCardList() {
        const listDiv = document.getElementById('card-list');
        listDiv.innerHTML = "Ø¯Ø± Ø­Ø§Ù„ Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨...";
        
        try {
            const res = await fetch(WORKER_URL, {
                method: "POST",
                body: JSON.stringify({ password: currentPassword, action: "list" })
            });
            const files = await res.json();
            
            listDiv.innerHTML = "";
            files.forEach(file => {
                if(file.name.endsWith('.html')) {
                    const item = document.createElement('div');
                    item.className = 'card-item';
                    item.innerHTML = `
                        <span>ğŸ“„ Ú©Ø§Ø±Øª Ø´Ù…Ø§Ø±Ù‡: <b>${file.name.replace('.html','')}</b></span>
                        <div onclick="deleteCard('${file.name}')" class="del-badge">Ø­Ø°Ù</div>
                    `;
                    listDiv.appendChild(item);
                }
            });
        } catch (e) { listDiv.innerHTML = "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª."; }
    }

    async function saveCard() {
        const num = document.getElementById('num').value;
        const t_mode = document.getElementById('t_status').value;
        const html = `
<div class="card-inner">
    <div class="card-front" data-admin-id="softshirazadmin2">
        <div class="date-bar">${document.getElementById('title').value}</div>
        <div class="img-bar"><img src="${document.getElementById('img').value}"></div>
        <div class="title-bar">${document.getElementById('time').value}</div>
        <div class="reserve-bar">
            <a class="reserve-btn ${t_mode === 'black' ? 'disabled' : ''}" style="color:${t_mode === 'blue' ? '#0037ff' : '#000'} !important;">
                ${t_mode === 'blue' ? 'ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·' : 'Ø¸Ø±ÙÛŒØª ØªÚ©Ù…ÛŒÙ„'}
            </a>
        </div>
    </div>
    <div class="card-back"><p>${document.getElementById('summary').value}</p></div>
</div>`.trim();

        await apiCall({ path: `cards/${num}.html`, content: btoa(unescape(encodeURIComponent(html))), action: "save" });
    }

    async function deleteCard(fileName) {
        if(!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ø§Ø±Øª ${fileName} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) return;
        await apiCall({ path: `cards/${fileName}`, action: "delete" });
    }

    async function apiCall(data) {
        data.password = currentPassword;
        const res = await fetch(WORKER_URL, { method: "POST", body: JSON.stringify(data) });
        if(res.ok) { alert("Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚"); loadCardList(); }
        else { alert("Ø®Ø·Ø§ Ø±Ø® Ø¯Ø§Ø¯"); }
    }
</script>
</body>
</html>
