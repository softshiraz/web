<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Watch Together</title>
<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family:tahoma;
  text-align:center;
}
video {
  width:80%;
  max-width:900px;
  margin-top:20px;
}
input, button {
  padding:10px;
  margin:5px;
  font-size:16px;
}
.hidden { display:none }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <h2>ورود</h2>
  <input id="username" placeholder="نام شما">
  <br>
  <input id="password" type="password" placeholder="رمز ورود">
  <br>
  <button onclick="login()">ورود</button>
</div>

<!-- OWNER -->
<div id="owner" class="hidden">
  <h3>مالک: <span id="ownerName"></span></h3>
  <video id="ownerVideo" controls>
    <source src="https://s1.dlserfes.info/dl1/2018/Tag%202018/Tag_2018_720p_BrRip_YIFY.mp4?md5=JgOv4DHH-E856mk-iRe8Aw&u=288589&expires=1766897453" type="video/mp4">
  </video>
</div>

<!-- VIEWER -->
<div id="viewer" class="hidden">
  <h3>بیننده: <span id="viewerName"></span></h3>
  <video id="viewerVideo">
    <source src="https://s1.dlserfes.info/dl1/2018/Tag%202018/Tag_2018_720p_BrRip_YIFY.mp4?md5=JgOv4DHH-E856mk-iRe8Aw&u=288589&expires=1766897453" type="video/mp4">
  </video>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ====== FIREBASE CONFIG ====== */
const firebaseConfig = {
  apiKey: "AIzaSyCZVi8SyjtW6dxMHDX7D0lZEdF5XPLtwJA",
  authDomain: "softshiraz-2ddce.firebaseapp.com",
  databaseURL: "https://softshiraz-2ddce-default-rtdb.firebaseio.com/",
  projectId: "softshiraz-2ddce",
  storageBucket: "softshiraz-2ddce.firebasestorage.app",
  messagingSenderId: "760975223534",
  appId: "1:760975223534:web:3008a1fbcc09a2ae2fe1ff",
  measurementId: "G-MRLRFEVB3D"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ====== PASSWORDS ====== */
const OWNER_PASS = "1111";
const VIEWER_PASS = "2222";

/* ====== LOGIN ====== */
username.value = localStorage.getItem("name") || "";

function login(){
  const name = username.value.trim();
  const pass = password.value;

  if(!name) return alert("نام را وارد کن");

  localStorage.setItem("name", name);
  document.getElementById("login").classList.add("hidden");

  if(pass === OWNER_PASS){
    ownerName.innerText = name;
    owner.classList.remove("hidden");
    initOwner();
  }
  else if(pass === VIEWER_PASS){
    viewerName.innerText = name;
    viewer.classList.remove("hidden");
    initViewer();
  }
  else {
    alert("رمز اشتباه است");
    location.reload();
  }
}

/* ====== OWNER LOGIC ====== */
function initOwner(){
  const v = ownerVideo;

  function sync(){
    db.ref("room").set({
      time: v.currentTime,
      playing: !v.paused
    });
  }

  v.addEventListener("play", sync);
  v.addEventListener("pause", sync);
  v.addEventListener("seeked", sync);
}

/* ====== VIEWER LOGIC ====== */
function initViewer(){
  const v = viewerVideo;
  v.controls = false;

  db.ref("room").on("value", snap => {
    const d = snap.val();
    if(!d) return;

    if(Math.abs(v.currentTime - d.time) > 0.7){
      v.currentTime = d.time;
    }

    if(d.playing){
      v.play();
    } else {
      v.pause();
    }
  });
}
</script>

</body>
</html>