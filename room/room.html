<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ù¾Ù„ÛŒØ± Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø¯ÙˆÙ† Ø³Ø±ÙˆØ±</title>
<style>
body{background:#111;color:#fff;font-family:tahoma;text-align:center;margin:0;padding:20px}
input,button{padding:8px;margin:3px}
video{width:90%;max-width:800px;margin:20px auto;display:block;background:black}
#chat{width:90%;max-width:800px;margin:20px auto;background:#222;padding:10px}
#messages{height:150px;background:#000;overflow-y:auto;margin-bottom:10px;padding:5px;text-align:left}
</style>
</head>
<body>

<h2>ðŸŽ¬ Ù¾Ù„ÛŒØ± Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø¯ÙˆÙ† Ø³Ø±ÙˆØ±</h2>

<input id="videoUrl" style="width:60%" placeholder="Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… ÙˆÛŒØ¯ÛŒÙˆ (mp4)">
<button onclick="loadVideo()">Ù¾Ø®Ø´</button>
<button onclick="copyLink()">ðŸ“Ž Ù„ÛŒÙ†Ú© Ø§ØªØ§Ù‚</button>

<video id="player" controls></video>

<div id="chat">
  <div id="messages"></div>
  <input id="msg" style="width:70%" placeholder="Ù¾ÛŒØ§Ù…...">
  <button onclick="sendMsg()">Ø§Ø±Ø³Ø§Ù„</button>
</div>

<script>
// --- Ù…ØªØºÛŒØ±Ù‡Ø§ ---
const video = document.getElementById("player");
const messages = document.getElementById("messages");

// --- Ù„ÛŒÙ†Ú© Ø§ØªØ§Ù‚ ---
function copyLink(){
    const url = new URL(window.location.href);
    url.searchParams.set('video', document.getElementById('videoUrl').value);
    navigator.clipboard.writeText(url.toString());
    alert("Ù„ÛŒÙ†Ú© Ø§ØªØ§Ù‚ Ú©Ù¾ÛŒ Ø´Ø¯!");
}

// --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø² URL ---
function loadVideo(){
    const urlInput = document.getElementById('videoUrl');
    if(!urlInput.value) return;
    video.src = urlInput.value;
    video.play();
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± URL
    const url = new URL(window.location.href);
    url.searchParams.set('video', urlInput.value);
    history.replaceState(null,null,url);
}

// --- Ú†Ú© Ú©Ø±Ø¯Ù† URL Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---
window.onload = () => {
    const params = new URLSearchParams(window.location.search);
    const videoParam = params.get('video');
    if(videoParam){
        document.getElementById('videoUrl').value = videoParam;
        video.src = videoParam;
    }
    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆÛŒØ¯ÛŒÙˆ Ù‡Ø± 2 Ø«Ø§Ù†ÛŒÙ‡
    setInterval(syncVideo,2000);
}

// --- Ù‡Ù…Ø²Ù…Ø§Ù† Ø³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ ---
function syncVideo(){
    const params = new URLSearchParams(window.location.search);
    const timeParam = parseFloat(params.get('time'));
    if(!isNaN(timeParam)){
        // Ø§Ú¯Ø± Ø§Ø®ØªÙ„Ø§Ù Ø¨ÛŒØ´ØªØ± Ø§Ø² 1 Ø«Ø§Ù†ÛŒÙ‡ Ø¨ÙˆØ¯ØŒ Ø³ÛŒÙ†Ú© Ú©Ù†
        if(Math.abs(video.currentTime - timeParam) > 1){
            video.currentTime = timeParam;
        }
    }
}

// --- Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ---
function sendMsg(){
    const msgInput = document.getElementById("msg");
    if(!msgInput.value) return;
    const div = document.createElement("div");
    div.textContent = msgInput.value;
    messages.appendChild(div);
    msgInput.value = "";
    messages.scrollTop = messages.scrollHeight;
}

// --- Ù‡Ù…Ø²Ù…Ø§Ù† Ø³Ø§Ø²ÛŒ Ø²Ù…Ø§Ù† ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ URL ---
video.addEventListener("timeupdate", ()=>{
    const url = new URL(window.location.href);
    url.searchParams.set('time', video.currentTime);
    history.replaceState(null,null,url);
});
</script>

</body>
</html>