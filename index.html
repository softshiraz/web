<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>سافت شیراز</title>
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css?v=3" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css?v=3">
<style>
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body { font-family:"Vazirmatn",sans-serif; background:#0e0e0f; color:#fff; overflow-x:hidden; }
#gold-particles { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; }
.particle { position:absolute; background:rgba(255,215,0,0.8); border-radius:50%; box-shadow:0 0 6px rgba(255,215,0,0.9); animation:floatDown linear infinite; }
@keyframes floatDown { from{transform:translateY(-120vh);opacity:1;} to{transform:translateY(120vh);opacity:0;} }
header { background:rgba(0,0,0,0.5); backdrop-filter:blur(10px); padding:15px 25px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(48,48,48,0.5); position:sticky; top:0; z-index:20; }
.logo-fa { font-weight:700; font-size:26px; background:linear-gradient(45deg,#ffd700,#ffb300); -webkit-background-clip:text; color:transparent; }
.hamburger-btn { width:48px; height:42px; background:rgba(26,26,26,0.6); border-radius:10px; border:2px solid rgba(255,215,0,0.25); color:#ffd700; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.hamburger-inner span { position:absolute; width:22px; height:2px; background:#ffd700; border-radius:2px; }
.hamburger-inner span:nth-child(1){top:4px;} .hamburger-inner span:nth-child(2){top:11px;} .hamburger-inner span:nth-child(3){top:18px;}
#side-menu { position:fixed; top:0; right:0; width:320px; max-width:85%; height:100vh; background:linear-gradient(180deg,rgba(12,12,12,0.98),rgba(20,20,20,0.98)); transform:translateX(100%); transition:transform .32s cubic-bezier(.2,.9,.2,1); z-index:30; padding:28px; display:flex; flex-direction:column; gap:18px; border-left:2px solid rgba(255,215,0,0.12); }
#side-menu.open { transform:translateX(0); }
#menu-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); opacity:0; pointer-events:none; transition:opacity .28s; z-index:25; }
#menu-backdrop.visible { opacity:1; pointer-events:auto; }
main { padding:35px 15px 60px; }
h2 { color:#ffd700; font-size:28px; text-align:center; margin-bottom:35px; border-bottom:3px solid #ffd700; display:inline-block; padding-bottom:6px; }
.movies-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; justify-items:center; max-width:1200px; margin:0 auto; }
.movie-card { perspective:1000px; }
.card-inner { position:relative; width:280px; height:420px; transform-style:preserve-3d; transition:transform .35s; cursor:pointer; }
.card-inner.flipped { transform:rotateY(180deg); }
.card-front, .card-back { position:absolute; inset:0; border-radius:16px; overflow:hidden; backface-visibility:hidden; border:2px solid rgba(255,215,0,0.65); box-shadow:0 0 12px rgba(255,215,0,0.3); background:rgba(19,19,20,0.85); backdrop-filter:blur(10px); }
.card-back { transform:rotateY(180deg); padding:20px; text-align:right; }
.img-bar img { width:100%; height:100%; object-fit:cover; transition:transform .4s; }
.movie-card:hover .img-bar img { transform:scale(1.08); }
.date-bar { height:52px; line-height:52px; background:rgba(0,0,0,0.5); color:#ffd700; text-align:center; font-weight:900; font-size:19px; text-shadow:0 0 12px rgba(255,215,0,0.8); }
.title-bar { height:36px; line-height:36px; background:rgba(0,0,0,0.4); color:#fff; text-align:center; font-size:15px; }
.reserve-bar { height:36px; line-height:36px; background:#ffd700; color:#000; text-align:center; font-weight:bold; cursor:pointer; }
.reserve-bar:hover { background:#ffea00; }
footer { background:rgba(0,0,0,0.5); backdrop-filter:blur(10px); padding:20px; text-align:center; border-top:1px solid rgba(48,48,48,0.5); }
.social-icon { width:48px; height:48px; background:rgba(26,26,26,0.7); backdrop-filter:blur(5px); border-radius:50%; display:inline-flex; align-items:center; justify-content:center; color:#ffd700; font-size:22px; }
.social-icon:hover { background:#ffd700; color:#000; }
#loading-overlay { position:fixed; inset:0; background:#111; display:flex; justify-content:center; align-items:center; z-index:10000; transition:opacity .6s; }
#loading-overlay.hidden { opacity:0; pointer-events:none; }
.loader { width:50px; height:50px; }
.loader .circle { position:absolute; width:48px; height:48px; opacity:0; transform:rotate(225deg); animation:orbit 5.5s infinite; }
.loader .circle:after { content:''; position:absolute; width:6px; height:6px; border-radius:50%; background:gold; }
.loader .circle:nth-child(2){animation-delay:240ms;} .loader .circle:nth-child(3){animation-delay:480ms;}
.loader .circle:nth-child(4){animation-delay:720ms;} .loader .circle:nth-child(5){animation-delay:960ms;}
@keyframes orbit { 0%{transform:rotate(225deg);opacity:1;} 75%{transform:rotate(945deg);} 76%{opacity:0;} 100%{opacity:0;} }
@media(max-width:1200px){.movies-grid{grid-template-columns:repeat(3,1fr);}}
@media(max-width:768px){.movies-grid{grid-template-columns:repeat(2,1fr);}}
@media(max-width:480px){.movies-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<div id="gold-particles"></div>

<div id="loading-overlay">
  <div class="loader">
    <div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div>
  </div>
</div>

<header>
  <button class="hamburger-btn" id="hamburger" aria-label="منو">
    <span class="hamburger-inner"><span></span><span></span><span></span></span>
  </button>
  <div class="logo-fa">Soft Shiraz</div>
</header>

<div id="menu-backdrop"></div>
<nav id="side-menu">
  <button id="menu-close"><i class="fas fa-times"></i></button>
  <div class="side-brand">Soft Shiraz</div>
  <div class="side-desc">معرفی اکران‌های آینده، رزرو بلیط و اخبار سینما</div>
  <div class="side-links">
    <a href="pages/past-releases.html">اکران‌های شده‌ها</a>
    <a href="events/events.html">ایونت‌ها</a>
    <a href="https://instagram.com/soft_shiraz" target="_blank">اینستاگرام</a>
    <a href="https://t.me/softshiraz" target="_blank">تلگرام</a>
    <a href="pages/about.html">درباره ما</a>
    <a href="https://t.me/FLOKI000">پشتیبانی</a>
  </div>
</nav>

<main>
  <section>
    <h2>اکران‌های آینده</h2>
    <div class="movies-grid" id="cards-container"></div>
  </section>
</main>

<footer>
  <div class="footer-title">سافت شیراز</div>
  <div class="social-row">
    <a class="social-icon" href="https://t.me/softshiraz" target="_blank"><i class="fab fa-telegram"></i></a>
    <a class="social-icon" href="https://instagram.com/soft_shiraz" target="_blank"><i class="fab fa-instagram"></i></a>
    <a class="social-icon" id="about-btn"><i class="fas fa-info"></i></a>
  </div>
</footer>

<script>
// ذرات طلایی
for(let i=0;i<80;i++){
  let p=document.createElement("div"); p.className="particle";
  let s=Math.random()*3+2;
  p.style.width=p.style.height=s+"px";
  p.style.left=Math.random()*100+"%";
  p.style.animationDuration=(Math.random()*6+6)+"s";
  p.style.animationDelay=Math.random()*5+"s";
  document.getElementById("gold-particles").appendChild(p);
}

// لودینگ + بارگذاری کارت‌ها
const container = document.getElementById("cards-container");
const loadingOverlay = document.getElementById("loading-overlay");
let loadedCount = 0;
let expectedCount = 0;

async function loadCards() {
  try {
    // مرحله ۱: گرفتن ترتیب از order.json
    const orderResponse = await fetch("cards/order.json?t=" + Date.now(), {cache: "no-store"});
    let order = [];
    if (orderResponse.ok) {
      order = await orderResponse.json();
    } else {
      // اگر order.json نبود، ترتیب پیش‌فرض ۱ تا ۱۵۰
      order = Array.from({length:150}, (_,i)=>i+1);
    }
    expectedCount = order.length;

    // مرحله ۲: لود کارت‌ها به ترتیب دلخواه
    for (const num of order) {
      try {
        const res = await fetch(`cards/${num}.html?t=${Date.now()}`, {cache: "no-store"});
        if (!res.ok) continue;
        const html = await res.text();
        const card = document.createElement("div");
        card.className = "movie-card";
        card.innerHTML = html;
        container.appendChild(card);
        loadedCount++;
      } catch(e) {
        console.log("کارت لود نشد:", num);
      }
    }
  } catch(e) {
    console.error("خطا در خواندن order.json", e);
    // فال‌بک: لود ۱ تا ۱۵۰
    for(let i=1;i<=150;i++){
      fetch(`cards/${i}.html?t=${Date.now()}`,{cache:"no-store"})
        .then(r=>r.ok?r.text():"")
        .then(html=>{ if(html){
          const card=document.createElement("div");
          card.className="movie-card";
          card.innerHTML=html;
          container.appendChild(card);
          loadedCount++;
        }});
    }
    expectedCount = 150;
  } finally {
    // حتی اگر خطا داد، بعد از حداکثر ۶ ثانیه لودینگ رو ببند
    setTimeout(hideLoading, 6000);
  }
}

function hideLoading() {
  loadingOverlay.classList.add("hidden");
}

// وقتی همه یا اکثر کارت‌ها لود شدن، لودینگ رو زودتر ببند
const checkIfDone = setInterval(()=>{
  if(loadedCount >= expectedCount || loadedCount >= 30){ // حداقل ۳۰ تا کارت یا همه
    clearInterval(checkIfDone);
    hideLoading();
  }
}, 500);

loadCards();

// رزرو بلیط
document.addEventListener("click", e=>{
  const btn = e.target.closest(".reserve-bar a");
  if(!btn || btn.textContent.trim() !== "تهیه بلیط") return;
  ;
  e.stopPropagation();
  const card = btn.closest(".card-front");
  const name = card.querySelector(".date-bar")?.textContent.trim() || "نامشخص";
  const time = card.querySelector(".title-bar")?.textContent.trim() || "نامشخص";
  const msg = `سلام وقت بخیر

فیلم: ${name}
سانس: ${time}

لطفاً موجودی و شرایط رزرو رو بفرمایید
ممنونم`;
  window.open(`https://t.me/softshirazadmin?text=${encodeURIComponent(msg)}`, "_blank");
});

// فلیپ کارت
let openCard = null;
document.addEventListener("click", e=>{
  if(e.target.closest(".reserve-bar")) return;
  const inner = e.target.closest(".card-inner");
  if(!inner) return;
  if(openCard && openCard!==inner) openCard.classList.remove("flipped");
  inner.classList.toggle("flipped");
  openCard = inner.classList.contains("flipped") ? inner : null;
});

// منوی همبرگری
const hamburger = document.getElementById("hamburger");
const sideMenu = document.getElementById("side-menu");
const backdrop = document.getElementById("menu-backdrop");
const closeBtn = document.getElementById("menu-close");
hamburger.onclick = ()=> { sideMenu.classList.toggle("open"); backdrop.classList.toggle("visible"); }
closeBtn.onclick = backdrop.onclick = ()=> { sideMenu.classList.remove("open"); backdrop.classList.remove("visible"); }
document.addEventListener("keydown", e=>{ if(e.key==="Escape") { sideMenu.classList.remove("open"); backdrop.classList.remove("visible"); }});

// درباره ما
document.getElementById("about-btn").onclick = e=>{ e.stopPropagation(); document.getElementById("about-popup").classList.toggle("show"); }
document.addEventListener("click",()=>{ document.getElementById("about-popup").classList.remove("show"); });
</script>
</body>
</html>
